<!DOCTYPE html>
<html>
  <head>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width" />
    <title>Whereami?</title>
    <link rel="stylesheet" href="assets/css/master.css" type="text/css" media="screen" />
    <script src="phonegap.js" type="text/javascript" charset="utf-8"></script>
    <script type="text/javascript">
      // Wait for PhoneGap to load
      document.addEventListener('deviceready', onDeviceReady, false );
      
      // PhoneGap is ready
      function onDeviceReady() {
        navigator.geolocation.getCurrentPosition( onLocated, onError, 
          { maximumAge: 3000, timeout: 5000, enableHighAccuracy: true } );
      }
      
      // On successful geolocation
      function onLocated( position ) {
        var element = document.getElementById('geolocation');
        element.innerHTML = 'Latitude: ' + position.coords.latitude + '<br />'
          + 'Longitude' + position.coords.longitude + '<br />'
          + 'Timestamp' + new Date(position.timestamp) + '<br />';
        
        var ajax = new XMLHttpRequest();
        ajax.open("GET","http://datafluency.com/geo/info/" + position.coords.latitude + '/' + position.coords.longitude + '/text',true);
        ajax.send();
        
        ajax.onreadystatechange=function() {
          if(ajax.readyState==4 && (ajax.status==200)){
               document.getElementById('geolocation').innerHTML  = 
      document.getElementById('geolocation').innerHTML + '<br/>' + ajax.responseText;
          }
        }
      }
      
      // On error
      function onError( error ) {
        alert( 'code: ' + error.code + '\n' + 
               'message: ' + error.message + '\n');
      }
    </script>
  </head>
  <body>
    <p id="geolocation">Finding geolocation...</p>
  </body>
</html>
